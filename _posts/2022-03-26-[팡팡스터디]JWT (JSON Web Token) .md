---
title:  "[HTTP/인증] JWT (JSON Web Token)"
excerpt: "JWT에 대하여"

categories:
  - node.js
tags:
  - [javascript,node.js,jwt]
  
toc: true
toc_sticky: true
 
date: 2022-03-26
last_modified_at: 2022-03-26
---
# 사용자 인증의 여러 방식들

## 쿠키와 세션

- HTTP는 Stateless , Connectionless의 특징을 가짐
- 사용자 인증을 유지할 수 있는 기능이 필요

클라이언트가 로그인 등으로 한 번 사용자 인증을 하면, 그 인증을 유지할 수 있도록 쿠키와 세션이라는 기술 사용.

**그러나 쿠키는 브라우저에 사용자 정보가 기록되기 때문에 위변조의 가능성이 높아 보안에 취약**

세션 또한 서버의 메모리를 차지
  - 동접자가 많은 웹 사이트일 경우 서버 과부화의 원인
  - 세션 정보가 중간에 탈취 당할 수 있기 때문에 보안에 완벽하다고 할 수가 없음.


## JWT
- 쿠키와 세션의 문제점들을 보완하기 위해 토큰( Token )기반의 인증 방식이 도입
- 토큰 기반의 인증 방식
- 보호할 데이터를 토큰으로 치환 , 원본 데이터 대신 토큰을 사용



## OAuth

- 토큰 방식을 사용하는 웹 서비스는 다양

- 페이스북으로 로그인 하기 와 같이 서비스의 계정으로 사용자 인증을 대신하는 기술.

- OAuth는 토큰 기반의 사용자 인증 방식

- 구글, 페이스북으로부터 토큰을 발급 받아 구글, 페이스북에 로그인 할 수 있도록 권한을 부여

  - 권한 : 로그인 , API를 호출하는 권한


- 발급 받은 토큰은 의미 없는 문자열 형태

  - 서버에서는 토큰과 연관된 정보를 탐색 한 후에 어떤 기능을 수행

**JWT는 서버의 탐색이 필요 없음**



# JWT ( JSON Web Token ) 

- JWT : Json으로 된 Token
- JWT는 토큰 자체가 의미를 갖는 Claim 기반의 토큰 방식
  - Claim( 권한 ) :  사용자에 대한 프로퍼티나 속성을 의미합니다.

## Token 생성,요청 프로세스

1. JSON 객체에 요구사항을 작성
2. 암호화 방식을 사용해서 문자열로 인코딩
3. HTTP header에 추가함으로써 사용자 인증을 요청
4. 서버에서는 Header에 추가된 Token을 디코딩하여 사용자를 인증합니다.


- JSON 객체 암호화, HTTP 헤더에 추가
- 보안성 증가
- 권한을 부여 -> 필요한 데이터가 JWT안에 있음
- OAuth와 달리 인증 서버에서 토큰에 대한 정보를 찾을 필요가 없음

## 그럼 JWT은 완전보안인가?

- 토큰을 탈취 -> 권한을 수행 가능해짐

- 토큰에 유효시간을 설정 -> 탈취 될 가능성을 줄이기 위해 유호시간 짦게 설정



## JWT의 데이터 무결성 - HMAC

- HMAC(Hash-based Message Authentication) 

- 해싱은 원문을 일정 길이의 byte로 변환 -> 유일한 데이터


## JWT 구조 및 생성
1. 헤더 ( header )
- typ :토큰의 타입을 명시
- alg 해싱 알고리즘을 명시

2. 내용 ( payload )
- 토큰에 대한 정보를 작성
- 정보는 속성, 값으로 표현 -> claim

3. 서명 ( signature )

-  헤더의 인코딩 값과 payload 인코딩 값을 "."으로 연결하여 합침 -> 비밀키로 해싱
- HTTP Only 옵션의 쿠키에 저장 권장